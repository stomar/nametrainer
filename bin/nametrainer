#!/usr/bin/ruby -w

require 'nametrainer'

SRCPATH = File.dirname(__FILE__)

module Nametrainer

  ERRORCODE = {:general => 1, :usage => 2}

  # Prints an error message and a short help information, then exits.
  def self.usage_fail(message) # :nodoc:
    warn "#{PROGNAME}: #{message}"
    warn "Use `#{PROGNAME} --help' for valid options."
    exit ERRORCODE[:usage]
  end
end

### main program

# parse options
begin
  options = Nametrainer::Optionparser.parse!(ARGV)
rescue => e
  Nametrainer.usage_fail(e.message)
end

# set up demo mode
if options[:demo]
  options[:collection] = File.expand_path("#{SRCPATH}/../demo_collection")
end

# start
app = Qt::Application.new ARGV

# try to add plugins path
begin
  qtbindings_path = Gem::Specification.find_by_name('qtbindings').gem_dir
  app.add_library_path("#{qtbindings_path}/bin/plugins")
rescue Gem::LoadError
end

Nametrainer::GUI.new(options)
app.exec
